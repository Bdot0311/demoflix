
# Complete Motion Graphics Video Engine Overhaul

## Objective
Transform the current "screenshot + text overlay" system into a true motion graphics engine that produces videos like the Gojiberry example - with animated cursor movements, dramatic zoom transitions, UI highlights, and synced AI voiceover.

---

## Phase 1: Database Schema - Store Motion Config

**Problem**: The `motion_config` (cursor paths, zoom targets, UI highlights) generated by AI is lost because the database doesn't have a column for it.

### Migration: Add motion_config column to scenes table
```sql
ALTER TABLE scenes ADD COLUMN motion_config jsonb;
```

This allows storing the full motion configuration:
```json
{
  "animation_style": "bounce-in",
  "spring": {"damping": 12, "mass": 1, "stiffness": 100},
  "cursor_path": {"startX": 100, "startY": 100, "endX": 500, "endY": 300, "clickFrame": 60},
  "zoom_targets": [{"x": 50, "y": 40, "scale": 1.8, "startFrame": 15, "endFrame": 75}],
  "ui_highlights": [{"x": 300, "y": 200, "width": 200, "height": 60, "label": "Key Feature"}]
}
```

---

## Phase 2: Enhanced Website Scraping

**File**: `supabase/functions/scrape-website/index.ts`

### Current Issue
- Only matching URLs ending in image extensions
- Missing images embedded in page HTML

### Fix: Request images directly from Firecrawl
```typescript
// Request all formats including extracted images
body: JSON.stringify({
  url: formattedUrl,
  formats: ['screenshot', 'links', 'markdown', 'branding', 'images'], // Add 'images' format
  waitFor: 3000,
}),

// Also extract Open Graph and meta images from branding data
result.images = [
  ...result.images,
  mainData.branding?.images?.logo,
  mainData.branding?.images?.ogImage,
  mainData.branding?.images?.favicon,
].filter(Boolean);
```

---

## Phase 3: Save Motion Config When Creating Scenes

**File**: `src/pages/NewDemo.tsx`

### Change: Store motion_config in database
```typescript
const scenesToInsert = data.scenes.map((scene: any, index: number) => ({
  project_id: projectId,
  asset_id: isSingleAsset ? (assets?.[0]?.id || null) : (assets?.[index]?.id || null),
  order_index: scene.order_index || index,
  headline: scene.headline || `Scene ${index + 1}`,
  subtext: scene.subtext || "",
  duration_ms: scene.duration_ms || Math.floor((selectedDuration * 1000) / data.scenes.length),
  transition: scene.transition || "fade",
  zoom_level: scene.zoom_level || 1.2,
  pan_x: scene.pan_direction === "left" ? -0.1 : scene.pan_direction === "right" ? 0.1 : 0,
  pan_y: scene.pan_direction === "up" ? -0.1 : scene.pan_direction === "down" ? 0.1 : 0,
  // NEW: Save the full motion config
  motion_config: scene.motion_config || null,
}));
```

---

## Phase 4: Load Motion Config in RemotionPreview

**File**: `src/components/editor/RemotionPreview.tsx`

### Current Issue
The `convertToRemotionScene` function hardcodes `defaultMotionConfig` and ignores any stored motion config.

### Fix: Use stored motion_config when available
```typescript
interface DBScene {
  id: string;
  headline: string;
  subtext: string;
  duration_ms: number;
  transition?: string;
  zoom_level?: number;
  pan_x?: number;
  pan_y?: number;
  motion_config?: any; // ADD THIS
  asset?: {
    file_url: string;
    file_type: string;
  };
}

const convertToRemotionScene = (
  scene: DBScene, 
  fallbackAsset?: { file_url: string; file_type: string }
): SceneData => {
  const asset = scene.asset || fallbackAsset;
  
  // Use stored motion_config if available, otherwise generate default
  const storedConfig = scene.motion_config;
  
  return {
    id: scene.id,
    headline: scene.headline || "",
    subtext: scene.subtext || "",
    imageUrl: asset?.file_url || "",
    durationInFrames: Math.round((scene.duration_ms / 1000) * FPS),
    motionConfig: storedConfig ? {
      animation_style: storedConfig.animation_style || "bounce-in",
      spring: storedConfig.spring || springPresets.bouncy,
      stagger_delay_frames: storedConfig.stagger_delay_frames || 2,
      entrance_delay_frames: storedConfig.entrance_delay_frames || 10,
      effects: storedConfig.effects || ["vignette", "glow", "particles"],
      camera: {
        zoom_start: 1.0,
        zoom_end: scene.zoom_level || 1.15,
        pan_x: scene.pan_x || 0,
        pan_y: scene.pan_y || 0,
      },
      // CRITICAL: Include demo effects
      cursor_path: storedConfig.cursor_path,
      zoom_targets: storedConfig.zoom_targets,
      ui_highlights: storedConfig.ui_highlights,
    } : {
      ...defaultMotionConfig,
      camera: {
        zoom_start: 1.0,
        zoom_end: scene.zoom_level || 1.15,
        pan_x: scene.pan_x || 0,
        pan_y: scene.pan_y || 0,
      },
    },
    transition: mapTransition(scene.transition),
  };
};
```

---

## Phase 5: More Dramatic Camera Movements

**File**: `supabase/functions/generate-storyboard/index.ts`

### Issue
Current pan values (0.1) are too subtle. The example video uses dramatic zooms and pans.

### Fix: Increase camera movement intensity
```typescript
// In the AI prompt, request more dramatic camera values
pan_direction: scene.pan_direction === "left" ? -5 : 
               scene.pan_direction === "right" ? 5 : 
               scene.pan_direction === "up" ? -3 : 
               scene.pan_direction === "down" ? 3 : 0,

// Also update zoom range in prompt
// 4. zoom_level: VARY between 1.0-2.0 (dramatic zooms for visual impact!)
```

---

## Phase 6: Voiceover Integration in Editor

**File**: `src/pages/Editor.tsx`

### Add voiceover generation button and audio sync
```typescript
// State for voiceover
const [voiceoverUrl, setVoiceoverUrl] = useState<string | null>(null);
const [isGeneratingVoiceover, setIsGeneratingVoiceover] = useState(false);

// Generate voiceover function
const handleGenerateVoiceover = async () => {
  setIsGeneratingVoiceover(true);
  try {
    // Create script from scene headlines and subtexts
    const script = scenes.map(s => `${s.headline}. ${s.subtext}`).join(' ');
    
    const { data, error } = await supabase.functions.invoke('generate-voiceover', {
      body: {
        scenes: scenes.map(s => ({
          headline: s.headline,
          subtext: s.subtext,
          duration_ms: s.duration_ms,
        })),
        style: project?.style || 'startup',
        totalDuration: scenes.reduce((sum, s) => sum + s.duration_ms, 0),
        tone: 'professional',
      },
    });
    
    if (data?.audioUrl) {
      setVoiceoverUrl(data.audioUrl);
      toast({ title: "Voiceover Generated!", description: "AI narration is ready" });
    }
  } catch (error) {
    toast({ variant: "destructive", title: "Voiceover Failed" });
  } finally {
    setIsGeneratingVoiceover(false);
  }
};
```

### Add UI button in branding panel
```tsx
<Button 
  onClick={handleGenerateVoiceover}
  disabled={isGeneratingVoiceover}
  className="w-full"
>
  {isGeneratingVoiceover ? (
    <>
      <Loader2 className="w-4 h-4 mr-2 animate-spin" />
      Generating Voiceover...
    </>
  ) : (
    <>
      <Mic className="w-4 h-4 mr-2" />
      Generate AI Voiceover
    </>
  )}
</Button>
```

---

## Phase 7: Fix ZoomHighlight Component

**File**: `src/remotion/components/ZoomHighlight.tsx`

Currently this component exists but needs integration verification.

### Ensure ZoomHighlight is being rendered in Scene.tsx
```typescript
// In Scene.tsx, add zoom target rendering
{motionConfig.zoom_targets?.map((target, idx) => (
  <ZoomHighlight
    key={idx}
    x={target.x}
    y={target.y}
    scale={target.scale}
    startFrame={target.startFrame}
    endFrame={target.endFrame}
  />
))}
```

---

## Files to Modify

| File | Changes |
|------|---------|
| `supabase/functions/scrape-website/index.ts` | Extract embedded images properly |
| `src/pages/NewDemo.tsx` | Save motion_config to database |
| `src/components/editor/RemotionPreview.tsx` | Load and use motion_config from DB |
| `src/pages/Editor.tsx` | Add voiceover generation button |
| `supabase/functions/generate-storyboard/index.ts` | More dramatic camera values |
| Database migration | Add motion_config jsonb column |

---

## Expected Result After Implementation

1. **Scraping**: Captures all page screenshots, embedded images, logos, and branding colors
2. **Motion Graphics**: Cursor animations, zoom highlights, and UI callouts appear in preview
3. **Camera Movement**: Dramatic Ken Burns zooms and pans (2x-3x more movement)
4. **Voiceover**: AI-generated narration synced to scenes via ElevenLabs
5. **Preview**: WYSIWYG - what you see in editor is what you get in final render

---

## Technical Note on "3D Motion Graphics"

The example video uses 2.5D motion graphics techniques:
- Layered elements with parallax
- Screen recordings with animated overlays
- Zoom/pan on flat images to create depth illusion

True 3D would require Three.js/WebGL integration which is a larger undertaking. The proposed solution achieves the same visual impact using Remotion's 2D transforms with depth-enhancing effects.
